name: node-metrics
code: node
description: 'node metrics collectors promql'
cronExpression: '@every 2h'
promQls:
  - name: 'cpu request'
    code: 'CPURequest'
    query: 'sum(kube_pod_container_resource_requests_cpu_cores) by (node)'
  - name: 'cpu limit'
    code: 'CPULimit'
    query: 'sum(kube_pod_container_resource_limits_cpu_cores) by (node)'
  - name: 'memory request'# 单位G
    code: 'MemoryRequest'
    query: 'sum(kube_pod_container_resource_requests_memory_bytes/1024/1024/1024) by (node)'
  - name: 'memory limit'
    code: 'MemoryLimit'
    query: 'sum(kube_pod_container_resource_limits_memory_bytes/1024/1024/1024) by (node)'
  - name: 'cpu usage max'
    code: 'CPUUsageMax'
    query: 'max_over_time(node_load1 [1h])'
  - name: 'cpu usage average'
    code: 'CPUUsageAvg'
    query: 'avg_over_time(node_load1 [1h]) '
  - name: 'cpu usage min'
    code: 'CPUUsageMin'
    query: 'min_over_time(node_load1 [1h]) '
  - name: 'memory usage max'# 单位：G
    code: 'MemoryUsageMax'
    query: '(node_memory_MemTotal_bytes-min_over_time(node_memory_MemAvailable_bytes[1h]))/1024/1024/1024'
  - name: 'memory usage average'
    code: 'MemoryUsageAvg'
    query: '(node_memory_MemTotal_bytes-avg_over_time(node_memory_MemAvailable_bytes[1h]))/1024/1024/1024'
  - name: 'memory usage min'
    code: 'MemoryUsageMin'
    query: '(node_memory_MemTotal_bytes-max_over_time(node_memory_MemAvailable_bytes[1h]))/1024/1024/1024'